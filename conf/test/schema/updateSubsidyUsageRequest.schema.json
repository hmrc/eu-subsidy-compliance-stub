{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "SCP06 JSON Request Schema",
  "description": "Subsidy Compliance - Amend Undertaking Subsidy Usage request schema v.1.0",
  "type": "object",
  "oneOf": [
    {
      "type": "object",
      "properties": {
        "undertakingIdentifier": {
          "type": "string",
          "pattern": "^.{1,17}$"
        },
        "undertakingSubsidyAmendment": {
          "description": "Mandatory if  “nilSubmission Date” is not populated",
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/undertakingSubsidyAmendmentType"
          }
        }
      },
      "required": [
        "undertakingIdentifier",
        "undertakingSubsidyAmendment"
      ],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "undertakingIdentifier": {
          "type": "string",
          "pattern": "^.{1,17}$"
        },
        "nilSubmissionDate": {
          "description": "Present if nil return submitted.",
          "$ref": "#/definitions/dateString"
        }
      },
      "required": [
        "undertakingIdentifier",
        "nilSubmissionDate"
      ],
      "additionalProperties": false
    }
  ],
  "definitions": {
    "undertakingSubsidyAmendmentType": {
      "type": "object",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "amendmentType": {
              "description": "Allowed values: 1 = Add",
              "type": "string",
              "enum": [
                "1"
              ]
            },
            "subsidyUsageTransactionId": {
              "description": "Unique Id for each subsidy usage record received. Generated by ETMP for 'Add' function. Mandatory for Amend and Delete records",
              "type": "string",
              "pattern": "^.{0,10}$"
            },
            "nonHMRCSubsidyAmtEUR": {
              "description": "Value of subsidy allocated in Euros",
              "type": "number",
              "multipleOf": 0.01,
              "minimum": 0.00,
              "maximum" : 99999999999.99
            },
            "allocationDate": {
              "description": "Date of allocation",
              "$ref": "#/definitions/dateString"
            },
            "submissionDate": {
              "description": "Date HMRC notified",
              "$ref": "#/definitions/dateString"
            },
            "publicAuthority": {
              "description": "Body allocating subsidy",
              "type": "string"
            },
            "traderReference": {
              "description": "Trader reference to identify allocation",
              "type": "string"
            },
            "businessEntityIdentifier": {
              "description": "EORI where subsidy allocated to a specific Undertaking member",
              "type": "string",
              "pattern": "^.{0,17}$"
            }
          },
          "required": [
            "amendmentType",
            "nonHMRCSubsidyAmtEUR",
            "allocationDate",
            "submissionDate",
            "publicAuthority"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "amendmentType": {
              "description": "Allowed values: 2 = Amend, 3 = Delete",
              "type": "string",
              "enum": [
                "2",
                "3"
              ]
            },
            "subsidyUsageTransactionId": {
              "description": "Unique Id for each subsidy usage record received. Generated by ETMP for 'Add' function. Mandatory for Amend and Delete records",
              "type": "string",
              "pattern": "^.{0,10}$"
            },
            "nonHMRCSubsidyAmtEUR": {
              "description": "Value of subsidy allocated in Euros",
              "type": "number",
              "multipleOf": 0.01,
              "minimum": 0.00,
              "maximum" : 99999999999.99
            },
            "allocationDate": {
              "description": "Date of allocation",
              "$ref": "#/definitions/dateString"
            },
            "submissionDate": {
              "description": "Date HMRC notified",
              "$ref": "#/definitions/dateString"
            },
            "publicAuthority": {
              "description": "Body allocating subsidy",
              "type": "string"
            },
            "traderReference": {
              "description": "Trader reference to identify allocation",
              "type": "string"
            },
            "businessEntityIdentifier": {
              "description": "EORI where subsidy allocated to a specific Undertaking member",
              "type": "string",
              "pattern": "^.{0,17}$"
            }
          },
          "required": [
            "amendmentType",
            "subsidyUsageTransactionId",
            "nonHMRCSubsidyAmtEUR",
            "allocationDate",
            "submissionDate",
            "publicAuthority"
          ],
          "additionalProperties": false
        }
      ]
    },
    "dateString": {
      "description": "YYYY-MM-DD",
      "type": "string",
      "pattern": "^(((15|16|17|18|19|20)([2468][048]|[13579][26]|0[48])|2000|1600)[-]02[-]29|((15|16|17|18|19|20)[0-9]{2}[-](0[469]|11)[-](0[1-9]|1[0-9]|2[0-9]|30)|(15|16|17|18|19|20)[0-9]{2}[-](0[13578]|1[02])[-](0[1-9]|[12][0-9]|3[01])|(15|16|17|18|19|20)[0-9]{2}[-]02[-](0[1-9]|1[0-9]|2[0-8])))$"
    }
  }

}